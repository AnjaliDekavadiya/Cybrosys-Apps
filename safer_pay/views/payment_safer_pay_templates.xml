<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="redirect_form">
        <form action="https://test.saferpay.com/api/Payment/v1/PaymentPage/Initialize"
              method="post">
            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
            <input type="hidden" name="RequestHeader" t-att-value="key"/>
            <input type="hidden" name="TerminalId" t-att-value="TerminalId"/>
            <input type="hidden" name="Payment" t-att-value="amount"/>
            <input type="hidden" name="ReturnUrl" t-att-value="ReturnUrl"/>
            <input type="submit" value="submit"/>
        </form>
    </template>

    <template id="safer_pay.token_form" inherit_id="payment.token_form">
        <xpath expr="//p[@name='o_payment_secured_by_desktop']"
               position="attributes">
            <attribute name="t-att-class"/>
            <attribute name="class">d-none</attribute>

        </xpath>
        <xpath expr="//p[@name='o_payment_secured_by_mobile']"
               position="attributes">
            <attribute name="class" separator=" " add="d-none"/>
        </xpath>
    </template>

    <template id="safer_pay.payment_method_form"
              inherit_id="payment.method_form">
        <xpath expr="//p[@name='o_payment_secured_by']" position="attributes">
            <attribute name="class" separator=" " add="d-none"/>
        </xpath>
    </template>
    <template id="inline_form">
        <div t-attf-id="safer-pay-container-{{provider_id}}">
            <t t-call="safer_pay.payment_details"/>
        </div>
    </template>

    <template id="token_inline_form">
        <div t-attf-id="safer-pay-token-container-{{token_sudo.id}}">
            <div class="alert alert-warning mb-0">
                <span t-if="token_sudo.safer_pay_simulated_state=='pending'">
                    Payments made with this payment method will remain <b>
                    pending</b>.
                </span>
                <span t-elif="token_sudo.safer_pay_simulated_state=='done'">
                    Payments made with this payment method will be <b>
                    successful</b>.
                </span>
                <span t-elif="token_sudo.safer_pay_simulated_state=='cancel'">
                    Payments made with this payment method will be automatically <b>
                    canceled</b>.
                </span>
                <span t-else="">
                    Payments made with this payment method will simulate a
                    processing <b>error</b>.
                </span>
            </div>
        </div>
    </template>

    <template id="express_checkout_form">
        <div name="o_express_checkout_container"
             t-attf-id="o_safer_pay_express_checkout_container_{{provider_sudo.id}}"
             t-att-data-provider-id="provider_sudo.id"
             t-att-data-provider-code="provider_sudo.code"
        >
            <div t-attf-id="o_safer_pay_modal_{{provider_sudo.id}}"
                 class="modal fade mt-5"
                 tabindex="-1"
                 aria-labelledby="o_safer_pay_modal_label"
                 aria-hidden="true"
            >
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title"
                                id="o_safer_pay_modal_label">
                                SaferPay Express Checkout
                            </h5>
                            <span t-if="provider_sudo.state == 'test'"
                                  class="badge rounded-pill text-bg-warning ms-1"
                            >
                                Test Mode
                            </span>
                            <button type="button"
                                    class="btn-close"
                                    data-bs-dismiss="modal"
                                    aria-label="Close"
                            />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>
    <template id="payment_details">
        <div class="row gap2 gap-md-0">
            <input name="provider_id" type="hidden" id="provider_id"
                   t-att-value="id"/>
            <input name="partner_id" type="hidden" t-att-value="partner_id"/>
            <div class="col-12 col-md mt-0 mb-0">
                <label for="customer_input" class="mt-0">
                    <small>Payment Details</small>
                </label>
                <input type="text"
                       name="customer_input"
                       id="customer_input"
                       class="form-control"
                       placeholder="XXXX XXXX XXXX XXXX"/>
            </div>
            <div class="col-12 col-md mb-0">
                <label for="simulated_payment_state" class="mt-0 text-muted">
                    <small>Payment Status</small>
                </label>
                <select id="simulated_payment_state" class="form-select">
                    <option value="done" title="Successful payment">
                        Successful
                    </option>
                    <option value="pending" title="Payment processing">
                        Pending
                    </option>
                    <option value="cancel" title="Payment canceled by customer">
                        Canceled
                    </option>
                    <option value="error" title="Processing error">
                        Error
                    </option>
                </select>
            </div>
        </div>
    </template>
</odoo>
